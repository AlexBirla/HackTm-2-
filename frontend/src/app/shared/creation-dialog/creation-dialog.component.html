<mat-card class="dialog-card">
  <h2 mat-dialog-title class="dialog-title" style="margin-left: 20%">
    {{ isViewMode ? 'Complaint Details' : 'Create a New Complaint' }}
  </h2>

  <div *ngIf="isViewMode" class="view-container">
    <div class="view-image-container">
      <img
        *ngIf="data?.url_poza; else noImage"
        [src]="data.url_poza"
        alt="Complaint Image"
        class="view-image"
      />
      <ng-template #noImage>
        <div class="no-image-placeholder">
          <mat-icon>image_not_supported</mat-icon>
          <span>No Image</span>
        </div>
      </ng-template>
    </div>

    <!-- RIGHT: Textual details -->
    <div class="view-details-container">
      <!-- Top Row: Title (left) & Status (right) -->
      <div class="view-header">
        <div class="view-title">{{ data.titlu }}</div>
        <div class="view-status">
          <mat-chip
            [color]="data.status === 'active' ? 'primary' : 'warn'"
            selected
          >
            {{ data.status | titlecase }}
          </mat-chip>
        </div>
      </div>

      <!-- Created At (beneath the header) -->
      <div class="view-created-at">
        Created on:
        {{ data.created_at | date: 'medium' }}
      </div>

      <!-- Description (middle) -->
      <div class="view-description">
        {{ data.descriere }}
      </div>

      <!-- Bottom Row: Upvotes / Downvotes aligned to bottom right -->
      <div class="view-footer">
        <div class="vote-counts">
          <button mat-button><mat-icon aria-hidden="false" aria-label="Upvotes">thumb_up</mat-icon>{{ data.upvotes }}</button>
          &nbsp;&nbsp;
          <button mat-button><mat-icon aria-hidden="false" aria-label="Downvotes">thumb_down</mat-icon>{{ data.downvotes }}</button>
        </div>
      </div>
    </div>
  </div>

  <form
    *ngIf="!isViewMode"
    [formGroup]="form"
    (ngSubmit)="onCreate()"
    class="create-form"
  >
    <mat-dialog-content class="dialog-content">
      <!-- TITLE FIELD -->
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Title</mat-label>
        <input matInput formControlName="title" />
        <mat-error *ngIf="form.get('title')?.hasError('required')">
          Title is required
        </mat-error>
      </mat-form-field>

      <!-- DESCRIPTION FIELD -->
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Description</mat-label>
        <textarea
          matInput
          formControlName="description"
          rows="4"
        ></textarea>
        <mat-error *ngIf="form.get('description')?.hasError('required')">
          Description is required
        </mat-error>
      </mat-form-field>

      <!-- IMAGE UPLOAD -->
      <div class="file-input">
        <button mat-stroked-button color="primary" type="button">
          <mat-icon>upload</mat-icon>
          <span>Select Image</span>
          <input
            type="file"
            (change)="onFileChange($event)"
            accept="image/*"
            hidden
          />
        </button>
        <span class="file-name" *ngIf="form.get('image')?.value as file">
          {{ file.name }}
        </span>
      </div>
    </mat-dialog-content>

    <mat-dialog-actions align="end">
      <button mat-button type="button" (click)="onCancel()">Cancel</button>
      <button
        mat-raised-button
        color="accent"
        type="submit"
        [disabled]="form.invalid"
      >
        Create
      </button>
    </mat-dialog-actions>
  </form>
</mat-card>
